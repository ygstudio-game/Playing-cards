<script>
    // Game state - moved to top
    const gameState = {
        players: [],
        currentPlayerIndex: 0,
        discardPile: [],
        currentPlay: null,
        consecutiveSkips: 0,
        gameLog: [],
        deck: [],
        playerCards: [],
        gameStarted: false,
        roomCode: '',
        isHost: false,
        playerName: '',
        maxPlayers: 3,
        playerId: '',
        socket: null,
        isMyTurn: false,
        connectionStatus: 'disconnected',
        reconnectAttempts: 0
    };

    // Card values and suits
    const cardValues = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
    const cardSuits = ['♥', '♦', '♣', '♠'];
    
    // Selected cards for play
    let selectedCards = [];
    
    // DOM elements - will be initialized after DOM loads
    let elements;

    // Initialize the game when DOM is loaded
    window.addEventListener('DOMContentLoaded', () => {
        initializeElements();
        initSocketConnection();
    });

    function initializeElements() {
        elements = {
            mainMenu: document.getElementById('main-menu'),
            createRoomModal: document.getElementById('create-room-modal'),
            joinRoomModal: document.getElementById('join-room-modal'),
            roomLobby: document.getElementById('room-lobby'),
            gameArea: document.getElementById('game-area'),
            playerCardsContainer: document.getElementById('player-cards'),
            playersList: document.getElementById('players-list'),
            discardPileContainer: document.getElementById('discard-pile'),
            currentPlayDisplay: document.getElementById('current-play'),
            currentClaimText: document.getElementById('current-claim'),
            gameLog: document.getElementById('game-log'),
            playCardsBtn: document.getElementById('play-cards-btn'),
            skipBtn: document.getElementById('skip-btn'),
            challengeBtn: document.getElementById('challenge-btn'),
            newGameBtn: document.getElementById('new-game-btn'),
            rulesBtn: document.getElementById('rules-btn'),
            rulesModal: document.getElementById('rules-modal'),
            closeRulesBtns: document.querySelectorAll('.close-rules-btn'),
            winnerModal: document.getElementById('winner-modal'),
            winnerText: document.getElementById('winner-text'),
            newGameWinnerBtn: document.getElementById('new-game-winner-btn'),
            closeWinnerBtn: document.getElementById('close-winner-btn'),
            claimSelect: document.getElementById('claim-select'),
            claimCount: document.getElementById('claim-count'),
            selectedCount: document.getElementById('selected-count'),
            createRoomBtn: document.getElementById('create-room-btn'),
            joinRoomBtn: document.getElementById('join-room-btn'),
            rulesMenuBtn: document.getElementById('rules-menu-btn'),
            closeCreateRoom: document.getElementById('close-create-room'),
            closeJoinRoom: document.getElementById('close-join-room'),
            hostName: document.getElementById('host-name'),
            playerCount: document.getElementById('player-count'),
            startRoomBtn: document.getElementById('start-room-btn'),
            playerName: document.getElementById('player-name'),
            roomCode: document.getElementById('room-code'),
            joinRoomSubmit: document.getElementById('join-room-submit'),
            displayRoomCode: document.getElementById('display-room-code'),
            copyRoomCode: document.getElementById('copy-room-code'),
            currentPlayers: document.getElementById('current-players'),
            maxPlayers: document.getElementById('max-players'),
            lobbyPlayers: document.getElementById('lobby-players'),
            leaveLobbyBtn: document.getElementById('leave-lobby-btn'),
            startGameBtn: document.getElementById('start-game-btn'),
            loadingScreen: document.getElementById('loading-screen'),
            serverStatus: document.getElementById('server-status')
        };
        
        setupEventListeners();
    }

    function showLoadingScreen(message = 'Loading...') {
        if (!elements.loadingScreen) return;
        
        elements.loadingScreen.innerHTML = `
            <div class="text-center">
                <div class="loader mx-auto mb-4"></div>
                <p class="text-xl">${message}</p>
                ${gameState.reconnectAttempts > 0 ? 
                    `<p class="text-sm text-gray-400 mt-2">Attempt ${gameState.reconnectAttempts + 1} of 5</p>` : ''}
            </div>
        `;
        elements.loadingScreen.classList.remove('hidden');
    }

    // Rest of your functions remain the same...
    // initSocketConnection, toggleCardSelection, playCards, etc.
    // Make sure to keep all other functions you had before

    function initSocketConnection() {
        showLoadingScreen('Connecting to server...');
        
        // For development, connect to local server
        // In production, you would connect to your actual server
        const socketUrl = window.location.hostname === 'localhost' ? 
            'http://localhost:3000' : 
            'https://your-production-server.com';
        
        gameState.socket = io(socketUrl, {
            reconnectionAttempts: 5,
            reconnectionDelay: 1000,
            transports: ['websocket'],
            auth: {
                playerName: gameState.playerName,
                isHost: gameState.isHost
            }
        });
        
        // Rest of your socket initialization code...
    }
</script>