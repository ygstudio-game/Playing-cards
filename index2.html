<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fake Card Challenge - Bluffing Card Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@400;600&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
        }
        
        .title-font {
            font-family: 'Playfair Display', serif;
        }
        
        .card {
            width: 80px;
            height: 120px;
            perspective: 1000px;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .card:hover {
            transform: translateY(-10px);
        }
        
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }
        
        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }
        
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .card-front {
            background: white;
            color: black;
            font-size: 24px;
            font-weight: bold;
        }
        
        .card-back {
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
            color: white;
            transform: rotateY(180deg);
        }
        
        .discard-pile {
            width: 80px;
            height: 120px;
            background: rgba(255,255,255,0.1);
            border: 2px dashed rgba(255,255,255,0.3);
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: rgba(255,255,255,0.5);
        }
        
        .player-active {
            box-shadow: 0 0 0 3px #4ade80;
        }
        
        .player-skipped {
            opacity: 0.7;
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            border-radius: 50%;
            animation: fall 5s linear infinite;
        }
        
        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        .tooltip {
            position: relative;
        }
        
        .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        
        .room-code {
            font-family: 'Courier New', monospace;
            letter-spacing: 2px;
        }
        
        .copy-btn {
            transition: all 0.3s;
        }
        
        .copy-btn:hover {
            transform: scale(1.05);
        }
        
        .copy-btn.copied {
            background-color: #10b981 !important;
        }
    </style>
</head>
<body class="text-white">
    <!-- Main Menu -->
    <div id="main-menu" class="fixed inset-0 flex items-center justify-center px-4">
        <div class="bg-gray-800 rounded-xl max-w-md w-full p-8 shadow-2xl">
            <div class="text-center mb-8">
                <h1 class="title-font text-4xl md:text-5xl font-bold mb-2 text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-red-500">
                    Fake Card Challenge
                </h1>
                <p class="text-lg text-gray-300">A bluff-based reverse card game</p>
            </div>
            
            <div class="space-y-4">
                <button id="create-room-btn" class="w-full bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white font-bold py-3 px-4 rounded-lg transition flex items-center justify-center">
                    <i class="fas fa-plus-circle mr-3 text-xl"></i> Create New Room
                </button>
                
                <button id="join-room-btn" class="w-full bg-gradient-to-r from-purple-600 to-purple-500 hover:from-purple-700 hover:to-purple-600 text-white font-bold py-3 px-4 rounded-lg transition flex items-center justify-center">
                    <i class="fas fa-sign-in-alt mr-3 text-xl"></i> Join Existing Room
                </button>
                
                <button id="rules-menu-btn" class="w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg transition flex items-center justify-center">
                    <i class="fas fa-book mr-3 text-xl"></i> Game Rules
                </button>
            </div>
        </div>
    </div>
    
    <!-- Create Room Modal -->
    <div id="create-room-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden px-4 z-50">
        <div class="bg-gray-800 rounded-xl max-w-md w-full p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold">Create Game Room</h2>
                <button id="close-create-room" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-1">Your Name</label>
                    <input type="text" id="host-name" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter your name">
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-1">Number of Players</label>
                    <select id="player-count" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="3">3 Players</option>
                        <option value="4">4 Players</option>
                        <option value="5">5 Players</option>
                        <option value="6">6 Players</option>
                    </select>
                </div>
                
                <div class="pt-2">
                    <button id="start-room-btn" class="w-full bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600 text-white font-bold py-3 px-4 rounded-lg transition">
                        Create Room
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Join Room Modal -->
    <div id="join-room-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden px-4 z-50">
        <div class="bg-gray-800 rounded-xl max-w-md w-full p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold">Join Game Room</h2>
                <button id="close-join-room" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-1">Your Name</label>
                    <input type="text" id="player-name" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter your name">
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-1">Room Code</label>
                    <input type="text" id="room-code" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter room code">
                </div>
                
                <div class="pt-2">
                    <button id="join-room-submit" class="w-full bg-gradient-to-r from-purple-600 to-purple-500 hover:from-purple-700 hover:to-purple-600 text-white font-bold py-3 px-4 rounded-lg transition">
                        Join Room
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Room Lobby -->
    <div id="room-lobby" class="fixed inset-0 bg-gray-900 flex items-center justify-center hidden px-4 z-40">
        <div class="bg-gray-800 rounded-xl max-w-2xl w-full p-6">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-2xl font-bold">Room Lobby</h2>
                    <div class="flex items-center mt-1">
                        <span class="text-gray-400 mr-2">Room Code:</span>
                        <span id="display-room-code" class="room-code font-mono bg-gray-700 px-3 py-1 rounded-lg"></span>
                        <button id="copy-room-code" class="copy-btn ml-2 bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded-lg text-sm">
                            <i class="fas fa-copy mr-1"></i> Copy
                        </button>
                    </div>
                </div>
                <div>
                    <span id="player-count-display" class="bg-blue-600 text-white px-3 py-1 rounded-lg text-sm">
                        <i class="fas fa-users mr-1"></i> <span id="current-players">1</span>/<span id="max-players">3</span>
                    </span>
                </div>
            </div>
            
            <div class="bg-gray-700 bg-opacity-50 rounded-lg p-4 mb-6">
                <h3 class="font-medium mb-3">Players Joined</h3>
                <div id="lobby-players" class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <!-- Players will be added here -->
                </div>
            </div>
            
            <div class="flex justify-between items-center">
                <button id="leave-lobby-btn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition">
                    <i class="fas fa-sign-out-alt mr-2"></i> Leave Lobby
                </button>
                
                <button id="start-game-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition disabled:opacity-50" disabled>
                    <i class="fas fa-play mr-2"></i> Start Game
                </button>
            </div>
        </div>
    </div>
    
    <!-- Game Area (hidden by default) -->
    <div id="game-area" class="container mx-auto px-4 py-8 hidden">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="title-font text-4xl md:text-5xl font-bold mb-2 text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-red-500">
                Fake Card Challenge
            </h1>
            <p class="text-lg text-gray-300">A bluff-based reverse card game where deception is your best weapon!</p>
        </header>
        
        <!-- Game Area -->
        <div class="flex flex-col lg:flex-row gap-8">
            <!-- Left Panel - Game Board -->
            <div class="flex-1">
                <!-- Game Controls -->
                <div class="bg-gray-800 bg-opacity-50 rounded-lg p-4 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold">Game Controls</h2>
                        <div class="flex gap-2">
                            <button id="new-game-btn" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition">
                                <i class="fas fa-redo mr-2"></i>New Game
                            </button>
                            <button id="rules-btn" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg transition">
                                <i class="fas fa-book mr-2"></i>Rules
                            </button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-gray-700 bg-opacity-50 p-4 rounded-lg">
                            <h3 class="font-medium mb-2">Current Play</h3>
                            <div id="current-play" class="flex items-center gap-2">
                                <div class="discard-pile">
                                    <i class="fas fa-question text-2xl"></i>
                                </div>
                                <span id="current-claim" class="text-gray-300">No cards played yet</span>
                            </div>
                        </div>
                        
                        <div class="bg-gray-700 bg-opacity-50 p-4 rounded-lg">
                            <h3 class="font-medium mb-2">Actions</h3>
                            <div class="flex flex-wrap gap-2">
                                <button id="play-cards-btn" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg transition disabled:opacity-50" disabled>
                                    <i class="fas fa-play mr-2"></i>Play Cards
                                </button>
                                <button id="skip-btn" class="bg-yellow-600 hover:bg-yellow-700 px-4 py-2 rounded-lg transition">
                                    <i class="fas fa-forward mr-2"></i>Skip
                                </button>
                                <button id="challenge-btn" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg transition disabled:opacity-50" disabled>
                                    <i class="fas fa-gavel mr-2"></i>Challenge
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Discard Pile -->
                <div class="bg-gray-800 bg-opacity-50 rounded-lg p-4 mb-6">
                    <h2 class="text-xl font-semibold mb-4">Discard Pile</h2>
                    <div id="discard-pile" class="flex flex-wrap gap-2 min-h-32">
                        <div class="discard-pile">
                            <i class="fas fa-layer-group text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <!-- Player Cards -->
                <div class="bg-gray-800 bg-opacity-50 rounded-lg p-4">
                    <h2 class="text-xl font-semibold mb-4">Your Cards</h2>
                    <div id="player-cards" class="flex flex-wrap gap-2 min-h-32">
                        <!-- Cards will be added here by JavaScript -->
                    </div>
                </div>
            </div>
            
            <!-- Right Panel - Players Info -->
            <div class="w-full lg:w-80">
                <div class="bg-gray-800 bg-opacity-50 rounded-lg p-4 sticky top-4">
                    <h2 class="text-xl font-semibold mb-4">Players</h2>
                    <div id="players-list" class="space-y-3">
                        <!-- Players will be added here by JavaScript -->
                    </div>
                    
                    <div class="mt-6">
                        <h3 class="font-medium mb-2">Game Log</h3>
                        <div id="game-log" class="bg-gray-900 bg-opacity-50 rounded-lg p-3 h-48 overflow-y-auto text-sm space-y-2">
                            <div class="text-gray-400">Game log will appear here...</div>
                        </div>
                    </div>
                    
                    <div class="mt-6 bg-gray-900 bg-opacity-30 p-4 rounded-lg">
                        <h3 class="font-medium mb-2">Card Claim</h3>
                        <div class="mb-3">
                            <label class="block text-sm mb-1">What are you claiming?</label>
                            <select id="claim-select" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white">
                                <option value="">Select a card value</option>
                                <!-- Options will be added by JavaScript -->
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm mb-1">How many cards?</label>
                            <input id="claim-count" type="number" min="1" value="1" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Rules Modal -->
    <div id="rules-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden z-50 px-4">
        <div class="bg-gray-800 rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold">Game Rules</h2>
                    <button id="close-rules-btn" class="text-gray-400 hover:text-white">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <h3 class="text-lg font-semibold mb-2">🎮 Game Overview</h3>
                        <p class="text-gray-300">"Fake Card Challenge" is a hilarious, high-stakes bluffing card game where the goal is to get rid of all your cards. Play one or more cards face-down, boldly announce what they are (truth or lie), and hope no one challenges you!</p>
                    </div>
                    
                    <div>
                        <h3 class="text-lg font-semibold mb-2">👥 Players</h3>
                        <p class="text-gray-300">3 to 6 players</p>
                    </div>
                    
                    <div>
                        <h3 class="text-lg font-semibold mb-2">🎯 Objective</h3>
                        <p class="text-gray-300">Be the first player to get rid of all your cards, by playing truthfully, bluffing smartly, or letting others trip up.</p>
                    </div>
                    
                    <div>
                        <h3 class="text-lg font-semibold mb-2">🧩 Setup</h3>
                        <ul class="list-disc pl-5 space-y-1 text-gray-300">
                            <li>Use a standard 52-card deck (plus Jokers if you like)</li>
                            <li>Shuffle and deal all cards equally to players</li>
                            <li>Place a face-down discard pile in the center</li>
                            <li>Choose who goes first randomly</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h3 class="text-lg font-semibold mb-2">📜 Gameplay Rules</h3>
                        <div class="space-y-3">
                            <div class="bg-gray-700 bg-opacity-50 p-3 rounded-lg">
                                <h4 class="font-medium">1. Your Turn</h4>
                                <p class="text-gray-300 mt-1">On your turn, you can either:</p>
                                <ul class="list-disc pl-5 space-y-1 text-gray-300 mt-1">
                                    <li>Play 1 or more cards face-down into the center pile (e.g., "These are two 9s" or "Three Queens")</li>
                                    <li>Skip your turn (say "skip" and do nothing)</li>
                                </ul>
                                <p class="text-gray-300 mt-1">You can bluff or be honest about your play.</p>
                            </div>
                            
                            <div class="bg-gray-700 bg-opacity-50 p-3 rounded-lg">
                                <h4 class="font-medium">2. The Challenge Option</h4>
                                <p class="text-gray-300 mt-1">The next player (or any player after that) may challenge the last face-down play.</p>
                                <ul class="list-disc pl-5 space-y-1 text-gray-300 mt-1">
                                    <li>Say: "I challenge!" to call a bluff</li>
                                    <li>Reveal the last set of played cards</li>
                                    <li>If the player lied → They take the entire discard pile</li>
                                    <li>If the player told the truth → The challenger takes the entire discard pile</li>
                                </ul>
                            </div>
                            
                            <div class="bg-gray-700 bg-opacity-50 p-3 rounded-lg">
                                <h4 class="font-medium">3. Skipping Rule</h4>
                                <p class="text-gray-300 mt-1">Any player can skip their turn.</p>
                                <ul class="list-disc pl-5 space-y-1 text-gray-300 mt-1">
                                    <li>If ALL remaining players skip in a row after a card has been played:</li>
                                    <li>The last person who placed cards gets to start the new round</li>
                                    <li>They can declare a new set of cards with a fresh bluff or truth</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="text-lg font-semibold mb-2">🏆 Winning</h3>
                        <p class="text-gray-300">The first player to discard all their cards is the winner!</p>
                    </div>
                </div>
                
                <div class="mt-6 text-center">
                    <button id="close-rules-btn-2" class="bg-purple-600 hover:bg-purple-700 px-6 py-2 rounded-lg transition">
                        Got it!
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Winner Modal -->
    <div id="winner-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden z-50 px-4">
        <div class="bg-gradient-to-br from-yellow-500 to-red-600 rounded-lg max-w-md w-full p-8 text-center">
            <h2 class="text-3xl font-bold mb-4">🎉 Winner! 🎉</h2>
            <p id="winner-text" class="text-xl mb-6">Player 1 has won the game!</p>
            <div class="flex justify-center gap-4">
                <button id="new-game-winner-btn" class="bg-white text-yellow-700 hover:bg-gray-100 px-6 py-2 rounded-lg transition font-semibold">
                    Play Again
                </button>
                <button id="close-winner-btn" class="bg-black bg-opacity-30 hover:bg-opacity-50 px-6 py-2 rounded-lg transition border border-white">
                    Close
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // Game state
        const gameState = {
            players: [],
            currentPlayerIndex: 0,
            discardPile: [],
            currentPlay: null,
            consecutiveSkips: 0,
            gameLog: [],
            deck: [],
            playerCards: [],
            gameStarted: false,
            roomCode: '',
            isHost: false,
            playerName: '',
            maxPlayers: 3
        };
        
        // DOM elements
        const elements = {
            mainMenu: document.getElementById('main-menu'),
            createRoomModal: document.getElementById('create-room-modal'),
            joinRoomModal: document.getElementById('join-room-modal'),
            roomLobby: document.getElementById('room-lobby'),
            gameArea: document.getElementById('game-area'),
            playerCardsContainer: document.getElementById('player-cards'),
            playersList: document.getElementById('players-list'),
            discardPileContainer: document.getElementById('discard-pile'),
            currentPlayDisplay: document.getElementById('current-play'),
            currentClaimText: document.getElementById('current-claim'),
            gameLog: document.getElementById('game-log'),
            playCardsBtn: document.getElementById('play-cards-btn'),
            skipBtn: document.getElementById('skip-btn'),
            challengeBtn: document.getElementById('challenge-btn'),
            newGameBtn: document.getElementById('new-game-btn'),
            rulesBtn: document.getElementById('rules-btn'),
            rulesModal: document.getElementById('rules-modal'),
            closeRulesBtns: [document.getElementById('close-rules-btn'), document.getElementById('close-rules-btn-2')],
            winnerModal: document.getElementById('winner-modal'),
            winnerText: document.getElementById('winner-text'),
            newGameWinnerBtn: document.getElementById('new-game-winner-btn'),
            closeWinnerBtn: document.getElementById('close-winner-btn'),
            claimSelect: document.getElementById('claim-select'),
            claimCount: document.getElementById('claim-count'),
            createRoomBtn: document.getElementById('create-room-btn'),
            joinRoomBtn: document.getElementById('join-room-btn'),
            rulesMenuBtn: document.getElementById('rules-menu-btn'),
            closeCreateRoom: document.getElementById('close-create-room'),
            closeJoinRoom: document.getElementById('close-join-room'),
            hostName: document.getElementById('host-name'),
            playerCount: document.getElementById('player-count'),
            startRoomBtn: document.getElementById('start-room-btn'),
            playerName: document.getElementById('player-name'),
            roomCode: document.getElementById('room-code'),
            joinRoomSubmit: document.getElementById('join-room-submit'),
            displayRoomCode: document.getElementById('display-room-code'),
            copyRoomCode: document.getElementById('copy-room-code'),
            currentPlayers: document.getElementById('current-players'),
            maxPlayers: document.getElementById('max-players'),
            lobbyPlayers: document.getElementById('lobby-players'),
            leaveLobbyBtn: document.getElementById('leave-lobby-btn'),
            startGameBtn: document.getElementById('start-game-btn')
        };
        
        // Card values and suits
        const cardValues = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
        const cardSuits = ['♥', '♦', '♣', '♠'];
        
        // Selected cards for play
        let selectedCards = [];
        
        // Initialize the game
        function initGame() {
            // Reset game state
            gameState.currentPlayerIndex = 0;
            gameState.discardPile = [];
            gameState.currentPlay = null;
            gameState.consecutiveSkips = 0;
            gameState.gameLog = [];
            gameState.deck = createDeck();
            gameState.playerCards = [];
            gameState.gameStarted = true;
            
            // Shuffle and deal cards
            shuffleDeck(gameState.deck);
            dealCards();
            
            // Update UI
            updatePlayersList();
            updatePlayerCards();
            updateDiscardPile();
            updateCurrentPlay();
            updateGameLog();
            updateActionButtons();
            populateClaimSelect();
            
            // Log initial game state
            addToGameLog('Game started! ' + gameState.players[0] + ' goes first.');
        }
        
        // Create a standard deck of cards
        function createDeck() {
            const deck = [];
            for (const suit of cardSuits) {
                for (const value of cardValues) {
                    deck.push({ value, suit, id: `${value}${suit}` });
                }
            }
            return deck;
        }
        
        // Shuffle the deck
        function shuffleDeck(deck) {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
        }
        
        // Deal cards to players
        function dealCards() {
            const playerCount = gameState.players.length;
            const cardsPerPlayer = Math.floor(gameState.deck.length / playerCount);
            
            for (let i = 0; i < playerCount; i++) {
                gameState.playerCards[i] = gameState.deck.slice(i * cardsPerPlayer, (i + 1) * cardsPerPlayer);
            }
        }
        
        // Update the players list UI
        function updatePlayersList() {
            elements.playersList.innerHTML = '';
            
            gameState.players.forEach((player, index) => {
                const isCurrent = index === gameState.currentPlayerIndex;
                const playerEl = document.createElement('div');
                playerEl.className = `bg-gray-700 bg-opacity-50 rounded-lg p-3 ${isCurrent ? 'player-active' : ''}`;
                
                playerEl.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div>
                            <span class="font-medium">${player}</span>
                            <span class="text-sm text-gray-400 ml-2">(${gameState.playerCards[index].length} cards)</span>
                        </div>
                        ${isCurrent ? '<span class="bg-green-500 text-xs px-2 py-1 rounded-full">Current</span>' : ''}
                    </div>
                `;
                
                elements.playersList.appendChild(playerEl);
            });
        }
        
        // Update the player's cards UI
        function updatePlayerCards() {
            elements.playerCardsContainer.innerHTML = '';
            selectedCards = [];
            
            const currentPlayerIndex = 0; // Always show human player's cards
            const cards = gameState.playerCards[currentPlayerIndex];
            
            cards.forEach((card, index) => {
                const cardEl = document.createElement('div');
                cardEl.className = 'card';
                cardEl.dataset.index = index;
                
                cardEl.innerHTML = `
                    <div class="card-inner">
                        <div class="card-front">
                            <div class="flex flex-col items-center">
                                <span class="${card.suit === '♥' || card.suit === '♦' ? 'text-red-500' : 'text-black'}">${card.value}</span>
                                <span class="${card.suit === '♥' || card.suit === '♦' ? 'text-red-500' : 'text-black'}">${card.suit}</span>
                            </div>
                        </div>
                        <div class="card-back"></div>
                    </div>
                `;
                
                cardEl.addEventListener('click', () => toggleCardSelection(cardEl, index));
                elements.playerCardsContainer.appendChild(cardEl);
            });
            
            // Enable play button if cards are selected
            elements.playCardsBtn.disabled = selectedCards.length === 0;
        }
        
        // Toggle card selection
        function toggleCardSelection(cardEl, index) {
            const isSelected = selectedCards.includes(index);
            
            if (isSelected) {
                // Deselect
                selectedCards = selectedCards.filter(i => i !== index);
                cardEl.classList.remove('flipped');
            } else {
                // Select
                selectedCards.push(index);
                cardEl.classList.add('flipped');
            }
            
            // Enable/disable play button
            elements.playCardsBtn.disabled = selectedCards.length === 0;
        }
        
        // Update the discard pile UI
        function updateDiscardPile() {
            elements.discardPileContainer.innerHTML = '';
            
            if (gameState.discardPile.length === 0) {
                elements.discardPileContainer.innerHTML = `
                    <div class="discard-pile">
                        <i class="fas fa-layer-group text-2xl"></i>
                    </div>
                `;
                return;
            }
            
            // Show the top card if revealed, otherwise show back
            const topCard = gameState.discardPile[gameState.discardPile.length - 1];
            
            const cardEl = document.createElement('div');
            cardEl.className = 'card';
            
            if (topCard.revealed) {
                cardEl.classList.add('flipped');
                cardEl.innerHTML = `
                    <div class="card-inner">
                        <div class="card-front">
                            <div class="flex flex-col items-center">
                                <span class="${topCard.suit === '♥' || topCard.suit === '♦' ? 'text-red-500' : 'text-black'}">${topCard.value}</span>
                                <span class="${topCard.suit === '♥' || topCard.suit === '♦' ? 'text-red-500' : 'text-black'}">${topCard.suit}</span>
                            </div>
                        </div>
                        <div class="card-back"></div>
                    </div>
                `;
            } else {
                cardEl.innerHTML = `
                    <div class="card-inner">
                        <div class="card-front">
                            <div class="flex flex-col items-center">
                                <span class="${topCard.suit === '♥' || topCard.suit === '♦' ? 'text-red-500' : 'text-black'}">${topCard.value}</span>
                                <span class="${topCard.suit === '♥' || topCard.suit === '♦' ? 'text-red-500' : 'text-black'}">${topCard.suit}</span>
                            </div>
                        </div>
                        <div class="card-back"></div>
                    </div>
                `;
            }
            
            elements.discardPileContainer.appendChild(cardEl);
        }
        
        // Update the current play UI
        function updateCurrentPlay() {
            if (!gameState.currentPlay) {
                elements.currentClaimText.textContent = 'No cards played yet';
                elements.currentPlayDisplay.querySelector('.discard-pile').innerHTML = '<i class="fas fa-question text-2xl"></i>';
                return;
            }
            
            const { playerIndex, cards, claim } = gameState.currentPlay;
            const playerName = gameState.players[playerIndex];
            
            elements.currentClaimText.textContent = `${playerName} claims: ${claim.count} ${claim.value}${claim.count > 1 ? 's' : ''}`;
            
            const pileEl = elements.currentPlayDisplay.querySelector('.discard-pile');
            pileEl.innerHTML = '';
            
            for (let i = 0; i < Math.min(3, cards.length); i++) {
                const cardEl = document.createElement('div');
                cardEl.className = 'card';
                cardEl.style.transform = `translateX(${i * 5}px)`;
                cardEl.style.zIndex = i;
                
                cardEl.innerHTML = `
                    <div class="card-inner">
                        <div class="card-front">
                            <div class="flex flex-col items-center">
                                <span class="text-black">?</span>
                                <span class="text-black">?</span>
                            </div>
                        </div>
                        <div class="card-back"></div>
                    </div>
                `;
                
                pileEl.appendChild(cardEl);
            }
            
            if (cards.length > 3) {
                const moreEl = document.createElement('div');
                moreEl.className = 'absolute -right-2 -bottom-2 bg-gray-800 rounded-full w-6 h-6 flex items-center justify-center text-xs';
                moreEl.textContent = `+${cards.length - 3}`;
                pileEl.appendChild(moreEl);
            }
        }
        
        // Update the game log
        function updateGameLog() {
            elements.gameLog.innerHTML = '';
            
            gameState.gameLog.forEach(log => {
                const logEl = document.createElement('div');
                logEl.className = 'border-b border-gray-700 pb-2';
                logEl.textContent = log;
                elements.gameLog.appendChild(logEl);
            });
            
            // Scroll to bottom
            elements.gameLog.scrollTop = elements.gameLog.scrollHeight;
        }
        
        // Add a message to the game log
        function addToGameLog(message) {
            gameState.gameLog.push(message);
            updateGameLog();
        }
        
        // Update action buttons state
        function updateActionButtons() {
            const isCurrentPlayerHuman = gameState.currentPlayerIndex === 0;
            
            // Human player can play or skip
            elements.playCardsBtn.disabled = !isCurrentPlayerHuman || selectedCards.length === 0;
            elements.skipBtn.disabled = !isCurrentPlayerHuman;
            
            // Challenge is available when there's a current play and it's not your play
            elements.challengeBtn.disabled = !gameState.currentPlay || gameState.currentPlay.playerIndex === 0;
        }
        
        // Populate the claim select dropdown
        function populateClaimSelect() {
            elements.claimSelect.innerHTML = '<option value="">Select a card value</option>';
            
            cardValues.forEach(value => {
                const option = document.createElement('option');
                option.value = value;
                option.textContent = value;
                elements.claimSelect.appendChild(option);
            });
        }
        
        // Play cards action
        function playCards() {
            if (selectedCards.length === 0) return;
            
            const claimValue = elements.claimSelect.value;
            const claimCount = parseInt(elements.claimCount.value);
            
            if (!claimValue || isNaN(claimCount) || claimCount < 1) {
                alert('Please select a valid card value and count');
                return;
            }
            
            // Get the selected cards
            const cardsToPlay = selectedCards.map(index => {
                return gameState.playerCards[0][index];
            });
            
            // Remove from player's hand
            gameState.playerCards[0] = gameState.playerCards[0].filter((_, index) => !selectedCards.includes(index));
            
            // Add to discard pile (face down)
            const playedCards = cardsToPlay.map(card => {
                return { ...card, revealed: false };
            });
            
            gameState.discardPile.push(...playedCards);
            
            // Set current play
            gameState.currentPlay = {
                playerIndex: 0,
                cards: playedCards,
                claim: {
                    value: claimValue,
                    count: claimCount
                }
            };
            
            // Reset consecutive skips
            gameState.consecutiveSkips = 0;
            
            // Move to next player
            nextPlayer();
            
            // Update UI
            updatePlayerCards();
            updateDiscardPile();
            updateCurrentPlay();
            updateActionButtons();
            
            // Log the play
            addToGameLog(`${gameState.players[0]} played ${playedCards.length} card(s) claiming they are ${claimCount} ${claimValue}${claimCount > 1 ? 's' : ''}`);
            
            // Check for win
            checkForWin();
        }
        
        // Skip action
        function skipTurn() {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            addToGameLog(`${currentPlayer} skipped their turn`);
            
            gameState.consecutiveSkips++;
            
            // Check if all players have skipped consecutively
            if (gameState.consecutiveSkips >= gameState.players.length - 1 && gameState.currentPlay) {
                // Last player to play gets control again
                gameState.currentPlayerIndex = gameState.currentPlay.playerIndex;
                gameState.consecutiveSkips = 0;
                addToGameLog(`All players skipped! ${gameState.players[gameState.currentPlayerIndex]} gets another turn.`);
            } else {
                // Move to next player
                nextPlayer();
            }
            
            updatePlayersList();
            updateActionButtons();
        }
        
        // Challenge action
        function challengePlay() {
            if (!gameState.currentPlay) return;
            
            const challengerIndex = 0; // Human player is always challenging
            const { playerIndex, cards, claim } = gameState.currentPlay;
            
            // Reveal the cards
            const revealedCards = cards.map(card => {
                return { ...card, revealed: true };
            });
            
            // Replace in discard pile
            const startIndex = gameState.discardPile.length - cards.length;
            gameState.discardPile.splice(startIndex, cards.length, ...revealedCards);
            
            // Check if the claim was truthful
            const actualValues = cards.map(card => card.value);
            const claimedValueCount = actualValues.filter(val => val === claim.value).length;
            
            let loserIndex;
            let message;
            
            if (claimedValueCount === claim.count) {
                // Claim was truthful - challenger loses
                loserIndex = challengerIndex;
                message = `${gameState.players[playerIndex]} told the truth! ${gameState.players[challengerIndex]} takes the discard pile.`;
            } else {
                // Claim was a lie - original player loses
                loserIndex = playerIndex;
                message = `${gameState.players[playerIndex]} lied! They take the discard pile.`;
            }
            
            // Loser takes the discard pile
            gameState.playerCards[loserIndex] = gameState.playerCards[loserIndex].concat(gameState.discardPile);
            gameState.discardPile = [];
            
            // Clear current play
            gameState.currentPlay = null;
            
            // Move to next player
            gameState.currentPlayerIndex = (loserIndex + 1) % gameState.players.length;
            
            // Update UI
            updatePlayersList();
            updateDiscardPile();
            updateCurrentPlay();
            updatePlayerCards();
            updateActionButtons();
            
            // Log the challenge
            addToGameLog(`${gameState.players[challengerIndex]} challenged! ${message}`);
            
            // Check for win
            checkForWin();
        }
        
        // Move to next player
        function nextPlayer() {
            gameState.currentPlayerIndex = (gameState.currentPlayerIndex + 1) % gameState.players.length;
            updatePlayersList();
        }
        
        // Check if a player has won
        function checkForWin() {
            for (let i = 0; i < gameState.players.length; i++) {
                if (gameState.playerCards[i].length === 0) {
                    showWinner(i);
                    return;
                }
            }
        }
        
        // Show winner modal
        function showWinner(playerIndex) {
            elements.winnerText.textContent = `${gameState.players[playerIndex]} has won the game!`;
            elements.winnerModal.classList.remove('hidden');
            
            // Create confetti effect
            for (let i = 0; i < 100; i++) {
                createConfetti();
            }
        }
        
        // Create confetti element
        function createConfetti() {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            
            // Random position
            const xPos = Math.random() * window.innerWidth;
            const yPos = -10;
            
            // Random color
            const colors = ['#f00', '#0f0', '#00f', '#ff0', '#f0f', '#0ff'];
            const color = colors[Math.floor(Math.random() * colors.length)];
            
            // Random size
            const size = Math.random() * 10 + 5;
            
            // Apply styles
            confetti.style.left = `${xPos}px`;
            confetti.style.top = `${yPos}px`;
            confetti.style.width = `${size}px`;
            confetti.style.height = `${size}px`;
            confetti.style.backgroundColor = color;
            
            // Random animation duration
            const duration = Math.random() * 3 + 2;
            confetti.style.animationDuration = `${duration}s`;
            
            // Add to body
            document.body.appendChild(confetti);
            
            // Remove after animation
            setTimeout(() => {
                confetti.remove();
            }, duration * 1000);
        }
        
        // Generate a random room code
        function generateRoomCode() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let result = '';
            for (let i = 0; i < 5; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }
        
        // Update lobby players list
        function updateLobbyPlayers() {
            elements.lobbyPlayers.innerHTML = '';
            
            gameState.players.forEach((player, index) => {
                const playerEl = document.createElement('div');
                playerEl.className = 'bg-gray-700 rounded-lg p-3 flex justify-between items-center';
                
                playerEl.innerHTML = `
                    <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center mr-3">
                            <i class="fas fa-user text-sm"></i>
                        </div>
                        <span class="font-medium">${player}</span>
                    </div>
                    ${index === 0 ? '<span class="bg-yellow-600 text-white text-xs px-2 py-1 rounded-full">Host</span>' : ''}
                `;
                
                elements.lobbyPlayers.appendChild(playerEl);
            });
            
            // Update player count
            elements.currentPlayers.textContent = gameState.players.length;
            
            // Enable start game button if host and enough players
            if (gameState.isHost && gameState.players.length >= 3) {
                elements.startGameBtn.disabled = false;
            } else {
                elements.startGameBtn.disabled = true;
            }
        }
        
        // Event listeners
        elements.playCardsBtn.addEventListener('click', playCards);
        elements.skipBtn.addEventListener('click', skipTurn);
        elements.challengeBtn.addEventListener('click', challengePlay);
        elements.newGameBtn.addEventListener('click', initGame);
        elements.rulesBtn.addEventListener('click', () => elements.rulesModal.classList.remove('hidden'));
        elements.closeRulesBtns.forEach(btn => btn.addEventListener('click', () => elements.rulesModal.classList.add('hidden')));
        elements.newGameWinnerBtn.addEventListener('click', () => {
            elements.winnerModal.classList.add('hidden');
            initGame();
        });
        elements.closeWinnerBtn.addEventListener('click', () => elements.winnerModal.classList.add('hidden'));
        
        // Menu event listeners
        elements.createRoomBtn.addEventListener('click', () => {
            elements.createRoomModal.classList.remove('hidden');
        });
        
        elements.joinRoomBtn.addEventListener('click', () => {
            elements.joinRoomModal.classList.remove('hidden');
        });
        
        elements.rulesMenuBtn.addEventListener('click', () => {
            elements.rulesModal.classList.remove('hidden');
        });
        
        elements.closeCreateRoom.addEventListener('click', () => {
            elements.createRoomModal.classList.add('hidden');
        });
        
        elements.closeJoinRoom.addEventListener('click', () => {
            elements.joinRoomModal.classList.add('hidden');
        });
        
        elements.startRoomBtn.addEventListener('click', () => {
            const name = elements.hostName.value.trim();
            const playerCount = parseInt(elements.playerCount.value);
            
            if (!name) {
                alert('Please enter your name');
                return;
            }
            
            gameState.playerName = name;
            gameState.isHost = true;
            gameState.maxPlayers = playerCount;
            gameState.roomCode = generateRoomCode();
            gameState.players = [name];
            
            // Show lobby
            elements.mainMenu.classList.add('hidden');
            elements.createRoomModal.classList.add('hidden');
            elements.roomLobby.classList.remove('hidden');
            
            // Update lobby UI
            elements.displayRoomCode.textContent = gameState.roomCode;
            elements.maxPlayers.textContent = gameState.maxPlayers;
            updateLobbyPlayers();
        });
        
        elements.joinRoomSubmit.addEventListener('click', () => {
            const name = elements.playerName.value.trim();
            const roomCode = elements.roomCode.value.trim().toUpperCase();
            
            if (!name) {
                alert('Please enter your name');
                return;
            }
            
            if (!roomCode || roomCode.length !== 5) {
                alert('Please enter a valid room code (5 characters)');
                return;
            }
            
            // In a real app, you would validate the room code with a server
            // For this demo, we'll just simulate joining a room
            gameState.playerName = name;
            gameState.isHost = false;
            gameState.roomCode = roomCode;
            gameState.players = ['Host Player', name]; // Simulated
            
            // Show lobby
            elements.mainMenu.classList.add('hidden');
            elements.joinRoomModal.classList.add('hidden');
            elements.roomLobby.classList.remove('hidden');
            
            // Update lobby UI
            elements.displayRoomCode.textContent = gameState.roomCode;
            elements.maxPlayers.textContent = '?';
            updateLobbyPlayers();
        });
        
        elements.copyRoomCode.addEventListener('click', () => {
            navigator.clipboard.writeText(gameState.roomCode).then(() => {
                elements.copyRoomCode.innerHTML = '<i class="fas fa-check mr-1"></i> Copied!';
                elements.copyRoomCode.classList.add('copied');
                
                setTimeout(() => {
                    elements.copyRoomCode.innerHTML = '<i class="fas fa-copy mr-1"></i> Copy';
                    elements.copyRoomCode.classList.remove('copied');
                }, 2000);
            });
        });
        
        elements.leaveLobbyBtn.addEventListener('click', () => {
            elements.roomLobby.classList.add('hidden');
            elements.mainMenu.classList.remove('hidden');
        });
        
        elements.startGameBtn.addEventListener('click', () => {
            // In a real app, you would notify all players to start the game
            elements.roomLobby.classList.add('hidden');
            elements.gameArea.classList.remove('hidden');
            
            // Initialize the game with the players in the lobby
            initGame();
        });
        
        // Initialize the main menu on load
        window.addEventListener('DOMContentLoaded', () => {
            elements.mainMenu.classList.remove('hidden');
        });
    </script>
</body>
</html>